<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
      crossorigin="anonymous"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap"
      rel="stylesheet"
    />
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-1.7.1.min.js"
    ></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"
    ></script>

    <script type="text/javascript"></script>

    <title>Auto Proctor | Exams</title>

    <style>
      * {
        font-family: "Open Sans", sans-serif;
      }

      .timer {
        font-size: 20px;
        align-items: center;
      }

      .nav {
        background-color: #e8e6fe;
        padding: 10px 70px;
      }

      .nav a {
        margin-top: 10px;
        font-size: 19px;
        text-decoration: none;
      }

      .nav span {
        margin-left: 5px;
        font-size: 17px;
        font-weight: bold;
      }

      #element {
        display: none;
      }

      #element:fullscreen {
        background-color: rgb(255, 255, 255);
      }

      #element:-webkit-full-screen {
        background-color: rgb(255, 255, 255);
      }

      #container:-moz-full-screen {
        background-color: rgb(255, 255, 255);
      }

      /*button*/
      .btn1,
      .btn1:link,
      .btn1:visited {
        text-transform: uppercase;
        text-decoration: none;
        display: inline-block;
        border-radius: 0.25rem;
        transition: all 0.2s;
        position: relative;
        cursor: pointer;
        background-color: #45ccc6;
        color: white;
        width: 200px;
        border: 1px solid transparent;
        padding: 0.375rem 0.75rem;
        margin-right: 51px;
      }

      .btn1:hover {
        transform: translate(-3px);
        box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.2);
      }

      #snackbar {
        visibility: hidden;
        min-width: 250px;
        margin-left: -125px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 2px;
        padding: 16px;
        position: fixed;
        z-index: 1;
        left: 50%;
        bottom: 30px;
        font-size: 17px;
      }

      #snackbar.show {
        visibility: visible;
        -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
        animation: fadein 0.5s, fadeout 0.5s 2.5s;
      }
    </style>
  </head>
  <body onclick="kkk()">
    <div id="element">
      <nav class="nav d-flex justify-content-between mb-5">
        <div class="" logo>
          <img src="../static/logo.jpg" alt="" width="90" />
          <span>Auto Proctor</span>
        </div>
        <a href="#" class="align-bottom">Logout</a>
      </nav>
      <div class="d-flex justify-content-around">
        <form action="">
          <div class="question1">
            <h3 class="my-2">1. What is Python?</h3>
            <div class="form-check mx-2 my-2">
              <input
                class="form-check-input"
                onclick="kkk()"
                type="radio"
                name="flexRadioDefault"
                id="flexRadioDefault1"
              />
              <label
                class="form-check-label"
                onclick="kkk()"
                for="flexRadioDefault1"
              >
                Programming Language
              </label>
            </div>
            <div class="form-check mx-2 my-2">
              <input
                class="form-check-input"
                onclick="kkk()"
                type="radio"
                name="flexRadioDefault"
                id="flexRadioDefault2"
              />
              <label
                class="form-check-label"
                onclick="kkk()"
                for="flexRadioDefault2"
              >
                Style Sheet
              </label>
            </div>
          </div>
          <div class="question1 my-5">
            <h3 class="my-2">2. Are Strings Immutable in Python?</h3>
            <div class="form-check mx-2 my-2">
              <input
                class="form-check-input"
                onclick="kkk()"
                type="radio"
                name="flexRadioDefault22"
                id="flexRadioDefault3"
              />
              <label
                class="form-check-label"
                onclick="kkk()"
                for="flexRadioDefault3"
              >
                Yes
              </label>
            </div>
            <div class="form-check mx-2 my-2">
              <input
                class="form-check-input"
                onclick="kkk()"
                type="radio"
                name="flexRadioDefault22"
                id="flexRadioDefault4"
              />
              <label
                class="form-check-label"
                onclick="kkk()"
                for="flexRadioDefault4"
              >
                No
              </label>
            </div>
          </div>
          <div class="question1">
            <h3 class="my-2">
              3. Which module is used for data science in Python?
            </h3>
            <div class="form-check mx-2 my-2">
              <input
                class="form-check-input"
                onclick="kkk()"
                type="radio"
                name="flexRadioDefault33"
                id="flexRadioDefault5"
              />
              <label
                class="form-check-label"
                onclick="kkk()"
                for="flexRadioDefault5"
              >
                Pandas
              </label>
            </div>
            <div class="form-check mx-2 my-2">
              <input
                class="form-check-input"
                onclick="kkk()"
                type="radio"
                name="flexRadioDefault33"
                id="flexRadioDefault6"
              />
              <label
                class="form-check-label"
                onclick="kkk()"
                for="flexRadioDefault6"
              >
                Math
              </label>
            </div>
          </div>
        </form>

        <div
          class="d-flex align-items-end flex-column bd-highlight mb-3"
          style="height: 600px"
        >
          <div class="timer">
            <div
              class="border border-primary text-center py-2 px-3 mb-5 align-middle d-flex flex-row"
            >
              Time Remaining &nbsp;&nbsp;: &nbsp;
              <p id="demo" disabled></p>
            </div>
            <div>
              <img
                src="{{ url_for('exam_feed') }}"
                class="exam-video"
                alt="..."
                height="300"
              />
            </div>
          </div>

          <div class="mt-auto p-2 bd-highlight">
            <button class="btn1" onclick="endexam()">Submit</button>
          </div>
        </div>
      </div>
      <div id="snackbar">Exam Submitted Successfully</div>
    </div>

    <script>
      const endexam = () => {
        var x = document.getElementById("snackbar");
        x.className = "show";
        setTimeout(function () {
          x.className = x.className.replace("show", "");
        }, 3000);

        window.setTimeout(function () {
          window.location.href = "{{url_for('home')}}";
        }, 3000);
      };

      $(document).ready(function () {
        setInterval(function () {
          $("#khatam").load(location.href + " #khatam");
        }, 1000);
      });
    </script>

    <script>
      // Ajax to Connect Socket Io from Python App.py
      $(document).ready(function () {
        var socket = io.connect("http://127.0.0.1:5000"); // Connection
        var mouthOpenWarn = 0;

        // Socket On Succesfull Connection
        socket.on("connect", function () {
          socket.emit("my event", { data: "connected succesfully" });
        });
        var isopened = false;

        // Socket on Response from Backend
        socket.on("output", function (msg) {
          if (!isopened) {
            if (msg.detection == "mouth") {
              mouthOpenWarn++;
            }
            isopened = true;
            swal
              .fire({
                title: msg.message,
                text: msg.title,
                icon: "warning",
                button: "OK",
                target: document.getElementById("element"),
              })
              .then(() => {
                isopened = false;
              });

            if (mouthOpenWarn == 2) {
              swal
                .fire({
                  title: msg.message,
                  text: msg.title,
                  icon: "warning",
                  button: "OK",
                  target: document.getElementById("element"),
                })
                .then(() => {
                  isopened = false;
                });
            }
            if (mouthOpenWarn > 5) {
              socket.emit("end exam", { end: "cam close" });
              swal
                .fire({
                  title: msg.message,
                  text: "Please dont Talk, Last warning",
                  icon: "warning",
                  button: "OK",
                  target: document.getElementById("element"),
                })
                .then(function () {
                  window.location.href = "/";
                });
            }
          }
        });
      });

      let warn = 0;
      /* Get into full screen */
      function GoInFullscreen(element) {
        if (element.requestFullscreen) element.requestFullscreen();
        else if (element.mozRequestFullScreen) element.mozRequestFullScreen();
        else if (element.webkitRequestFullscreen)
          element.webkitRequestFullscreen();
        else if (element.msRequestFullscreen) element.msRequestFullscreen();
      }

      /* Get out of full screen */
      function GoOutFullscreen() {
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        else if (document.msExitFullscreen) document.msExitFullscreen();
      }

      /* Is currently in full screen or not */
      function IsFullScreenCurrently() {
        var full_screen_element =
          document.fullscreenElement ||
          document.webkitFullscreenElement ||
          document.mozFullScreenElement ||
          document.msFullscreenElement ||
          null;

        // If no element is in full-screen
        if (full_screen_element === null) return false;
        else return true;
      }

      swal
        .fire("Exam Started", "You Will Enter Full Screen Mode", "warning", {
          button: "OK",
        })
        .then(function () {
          $("#element").show();
          if (IsFullScreenCurrently()) GoOutFullscreen();
          else GoInFullscreen($("#element").get(0));
        });

      if (document.addEventListener) {
        document.addEventListener("fullscreenchange", exitHandler, false);
        document.addEventListener("mozfullscreenchange", exitHandler, false);
        document.addEventListener("MSFullscreenChange", exitHandler, false);
        document.addEventListener("webkitfullscreenchange", exitHandler, false);
      }

      function exitHandler() {
        if (
          !document.webkitIsFullScreen &&
          !document.mozFullScreen &&
          !document.msFullscreenElement
        ) {
          swal
            .fire(
              "Fullscreen exit",
              "You Tried To Exit Fullscreen",
              "warning",
              {
                button: "OK",
              }
            )
            .then(function () {
              if (IsFullScreenCurrently()) GoOutFullscreen();
              else GoInFullscreen($("#element").get(0));
            });
          warn++;
          if (warn == 2) {
            swal
              .fire("Last Warning", "You Tried To Exit Fullscreen", "warning", {
                button: "OK",
              })
              .then(function () {
                if (IsFullScreenCurrently()) GoOutFullscreen();
                else GoInFullscreen($("#element").get(0));
              });
          }
          if (warn > 2) {
            swal
              .fire(
                "Fullscreen exit",
                "Exited Fullscreen Multiple times. Your exam has Ended",
                "warning",
                {
                  button: "OK",
                }
              )
              .then(function () {
                window.location.href = "/";
              });
          }
        }
      }

      // Set the date we're counting down to
      var countDownDate = new Date();
      countDownDate.setMinutes(countDownDate.getMinutes() + 60);

      // Update the count down every 1 second
      var x = setInterval(function () {
        // Get today's date and time
        var now = new Date().getTime() + 1;

        // Find the distance between now and the count down date
        var distance = countDownDate - now;

        // Time calculations for days, hours, minutes and seconds
        var hours = Math.floor(
          (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // Output the result in an element with id="demo"
        document.getElementById("demo").innerHTML =
          hours + "h " + minutes + "m " + seconds + "s ";

        // If the count down is over, write some text
        if (distance < 0) {
          clearInterval(x);
          document.getElementById("demo").innerHTML = "EXPIRED";
        }
      }, 1000);

      document.onkeydown = keydown;
    </script>
  </body>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
    crossorigin="anonymous"
  ></script>
  <script
    src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"
    type="text/javascript"
  ></script>
</html>
